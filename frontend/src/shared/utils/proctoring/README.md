# Модульная система прокторинга

Этот документ описывает архитектуру модульной системы прокторинга, которая была разделена на отдельные модули для улучшения поддерживаемости и организации кода.

## Структура модулей

```
proctoring/
├── config.ts                    # Конфигурационные константы
├── types.ts                     # TypeScript интерфейсы и типы
├── session-manager.ts           # Управление сессиями прокторинга
├── violation-manager.ts         # Обработка и логирование нарушений
├── screen-recorder.ts           # Запись экрана и загрузка видео
├── face-analyzer.ts             # Анализ лица и детекция поведения
├── environment-detectors.ts     # Детекторы браузерных событий
└── index.ts                     # Основной хук useProctoring
```

## Описание модулей

### config.ts
Содержит все конфигурационные константы системы:
- `PROCTORING_CONFIG` - общие настройки прокторинга
- `FACE_ANALYSIS_CONFIG` - настройки анализа лица
- `RECORDER_CONFIG` - настройки записи экрана
- `VIOLATION_TYPES` - типы нарушений

### types.ts
Определяет TypeScript интерфейсы:
- `ProctoringState` - состояние прокторинга
- `ScreenState` - состояние экрана
- `AudioState` - состояние аудио
- `FaceAnalysisResult` - результат анализа лица

### session-manager.ts
Класс `SessionManager` управляет:
- Текущей сессией прокторинга
- Предварительными и основными тестами
- Восстановлением неудачных загрузок

### violation-manager.ts
Класс `ViolationManager` отвечает за:
- Определение серьезности нарушений
- Логирование нарушений на сервер
- Показ уведомлений пользователю
- Завершение теста при критических нарушениях

### screen-recorder.ts
Класс `ScreenRecorder` обеспечивает:
- Запись экрана с камерой
- Автоматическое сохранение промежуточных записей
- Загрузку видео на сервер с повторными попытками
- Обработку ошибок записи

### face-analyzer.ts
Класс `FaceAnalyzer` выполняет:
- Детекцию лиц на видео
- Анализ поворотов головы и направления взгляда
- Определение закрытых глаз
- Стабилизацию детекции нарушений

### environment-detectors.ts
Функция `initializeEnvironmentDetectors` настраивает:
- Детекцию смены вкладок
- Обнаружение DevTools
- Блокировку подозрительных hotkey
- Отслеживание копирования/вставки

### index.ts
Основной файл, содержащий:
- Хук `useProctoring` с полным API
- Интеграцию всех модулей
- Управление жизненным циклом прокторинга

## Преимущества модульной архитектуры

1. **Разделение ответственности**: каждый модуль имеет четко определенную функцию
2. **Легкость тестирования**: модули можно тестировать независимо
3. **Переиспользование**: модули можно использовать в других частях приложения
4. **Поддерживаемость**: изменения в одном модуле не влияют на другие
5. **Читаемость**: код стал более структурированным и понятным

## Использование

Импорт остается прежним благодаря реэкспорту в основном файле `proctoring.ts`:

```typescript
import { useProctoring, ProctoringState, setCurrentSessionId } from '@shared/utils/proctoring';
```

Все существующие компоненты продолжают работать без изменений.

## Расширение функциональности

Для добавления новых функций:

1. Создайте новый модуль в папке `proctoring/`
2. Экспортируйте нужные функции/классы
3. Импортируйте и используйте в `index.ts`
4. При необходимости обновите типы в `types.ts`
